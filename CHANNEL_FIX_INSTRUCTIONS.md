# Исправление проблемы с обработкой сообщений от каналов

## Проблема
Бот неправильно обрабатывал сообщения от каналов, которые публикуются от имени канала (sender_chat), что приводило к:
- Анализу системного пользователя Telegram (777000) как подозрительного профиля
- Неправильному определению каналов как "foreign" вместо "native"
- Удалению сообщений и блокировке каналов

## Внесенные исправления

### 1. SuspiciousProfileMiddleware
- Добавлена проверка для пропуска системного пользователя Telegram (777000)
- Теперь middleware не анализирует профили сообщений от каналов

### 2. ChannelService
- Добавлена поддержка конфигурации native каналов
- Исправлена логика определения native каналов
- Добавлен параметр `native_channel_ids` в конструктор

### 3. LinkService
- Добавлена проверка для пропуска анализа bot links для сообщений от каналов
- Теперь LinkService не считает медиа от каналов подозрительным

### 4. Конфигурация
- Добавлено поле `native_channel_ids` в Settings
- Обновлен `env.example` с примером настройки
- Добавлена поддержка отрицательных ID каналов

### 5. DependencyInjection
- Обновлен для передачи `native_channel_ids` в ChannelService

## Настройка

### 1. Создайте файл .env
Скопируйте `env.example` в `.env` и добавьте ID вашего канала:

```bash
cp env.example .env
```

### 2. Добавьте ID канала в .env
```env
# Native Channels (каналы, где бот является администратором)
NATIVE_CHANNEL_IDS=-10000000000
```

Замените `-100000000000` на ID вашего канала. ID канала можно найти в логах бота.

### 3. Перезапустите бота
```bash
# Если используете Docker
docker-compose restart

# Если запускаете напрямую
python bot.py
```

## Проверка работы

После настройки:
1. Опубликуйте сообщение в канале от имени канала
2. Проверьте логи - не должно быть предупреждений о подозрительных профилях
3. Сообщение должно пройти без удаления
4. Комментарии к посту должны работать нормально

## Логи для отладки

Ищите в логах:
- `"Skipping profile analysis for Telegram system user (777000)"` - профиль не анализируется
- `"Skipping bot link check for message from channel"` - bot links не проверяются
- `"Channel -1002451070110 is native: true"` - канал определяется как native

## Дополнительные каналы

Если у вас несколько каналов, добавьте их ID через запятую:
```env
NATIVE_CHANNEL_IDS=-1000000000000,-1001234567890,-1009876543210
```
