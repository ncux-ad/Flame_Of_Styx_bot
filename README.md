# ü§ñ Flame of Styx - AntiSpam Telegram Bot

[![Python](https://img.shields.io/badge/Python-3.11+-blue.svg)](https://python.org)
[![Aiogram](https://img.shields.io/badge/Aiogram-3.12.0-green.svg)](https://docs.aiogram.dev)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)
[![Code Quality](https://github.com/ncux-ad/Flame_Of_Styx_bot/actions/workflows/code-quality.yml/badge.svg)](https://github.com/ncux-ad/Flame_Of_Styx_bot/actions/workflows/code-quality.yml)

> **–ú–æ—â–Ω—ã–π –∞–Ω—Ç–∏—Å–ø–∞–º –±–æ—Ç –¥–ª—è Telegram —Å –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è**

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- **Python 3.11+**
- **Redis** (–¥–ª—è rate limiting)
- **SQLite** (–≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ë–î)
- **Ubuntu 20.04+** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

### ‚ö° –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞ 5 –º–∏–Ω—É—Ç

```bash
# 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/ncux-ad/Flame_Of_Styx_bot.git
cd Flame_Of_Styx_bot

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å —É–º–Ω—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É
bash scripts/install-bot.sh

# 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
bash scripts/install-monitoring.sh
```

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üõ°Ô∏è –ê–Ω—Ç–∏—Å–ø–∞–º –∑–∞—â–∏—Ç–∞
- **–£–º–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è** - ML-–∞–ª–≥–æ—Ä–∏—Ç–º—ã –¥–ª—è –¥–µ—Ç–µ–∫—Ü–∏–∏ —Å–ø–∞–º–∞
- **Rate limiting** - –∑–∞—â–∏—Ç–∞ –æ—Ç —Ñ–ª—É–¥–∞
- **–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏** - –∞–Ω–∞–ª–∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±–∞–Ω—ã** - –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø—Ä–∞–≤–∏–ª–∞

### üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- **Glances** - —Å–∏—Å—Ç–µ–º–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- **Healthcheck** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–æ—Ç–∞
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **–ú–µ—Ç—Ä–∏–∫–∏** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### ‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- **–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å** - –ø–æ–ª–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–∏–º–∏—Ç–æ–≤** - –≥–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞–º–∏** - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –ø–æ–¥—Ä–æ–±–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### üìù –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`:

```env
# Telegram Bot Token
BOT_TOKEN=your_bot_token_here

# Redis –¥–ª—è rate limiting
REDIS_URL=redis://localhost:6379/0

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞
ADMIN_IDS=123456789,987654321
DEBUG=false
LOG_LEVEL=INFO

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
ENABLE_MONITORING=true
GLANCES_WEB_PORT=61208
HEALTHCHECK_PORT=8081
```

### ‚öôÔ∏è –õ–∏–º–∏—Ç—ã –∏ –ø—Ä–∞–≤–∏–ª–∞

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ `limits.json`:

```json
{
  "max_messages_per_minute": 10,
  "max_links_per_message": 3,
  "ban_duration_hours": 24,
  "suspicion_threshold": 0.55,
  "allow_photos_without_caption": true,
  "allow_videos_without_caption": true
}
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### üåê –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- **Glances**: `http://your-server:61208`
- **Healthcheck**: `http://your-server:8081/healthcheck.php`
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: glances-admin / –≤–∞—à-–ø–∞—Ä–æ–ª—å

### üì± Telegram –∫–æ–º–∞–Ω–¥—ã
- `/status` - —Å—Ç–∞—Ç—É—Å –±–æ—Ç–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- `/settings` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–Ω—Ç–∏—Å–ø–∞–º–∞
- `/suspicious` - –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏
- `/channels` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞–º–∏
- `/setlimits` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–∏–º–∏—Ç–æ–≤

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
Flame_Of_Styx_bot/
‚îú‚îÄ‚îÄ app/                    # –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ handlers/          # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
‚îÇ   ‚îú‚îÄ‚îÄ middlewares/       # Middleware –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ services/          # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ models/            # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ utils/             # –£—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ scripts/               # –°–∫—Ä–∏–ø—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–∫–∏
‚îú‚îÄ‚îÄ docs/                  # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ tests/                 # –¢–µ—Å—Ç—ã
‚îî‚îÄ‚îÄ monitoring/            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
```

### üîÑ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- **Bot Core** - —è–¥—Ä–æ –±–æ—Ç–∞ –Ω–∞ aiogram 3.12
- **AntiSpam Engine** - –¥–≤–∏–∂–æ–∫ –∞–Ω—Ç–∏—Å–ø–∞–º–∞
- **Rate Limiter** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤
- **Monitoring System** - —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- **Admin Interface** - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### üê≥ Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
# –ó–∞–ø—É—Å–∫ –≤ production
docker-compose -f docker-compose.prod.yml up -d

# –ó–∞–ø—É—Å–∫ —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º
docker-compose -f docker-compose.monitoring.yml up -d
```

### ‚öôÔ∏è Systemd (–¥–ª—è VPS)
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–∞–∫ —Å–µ—Ä–≤–∏—Å
sudo cp systemd/antispam-bot.service /etc/systemd/system/
sudo systemctl enable antispam-bot
sudo systemctl start antispam-bot
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
pytest

# –¢–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest --cov=app

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
bandit -r app/
safety check
```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **[–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞](docs/ADMIN_GUIDE.md)**
- **[–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞](docs/DEVELOPMENT.md)**
- **[API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](docs/API.md)**
- **[–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](docs/SECURITY.md)**
- **[–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥](MONITORING_SETUP.md)**

## ü§ù –£—á–∞—Å—Ç–∏–µ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

1. **Fork** —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
2. –°–æ–∑–¥–∞–π—Ç–µ **feature branch**: `git checkout -b feature/amazing-feature`
3. **Commit** –∏–∑–º–µ–Ω–µ–Ω–∏—è: `git commit -m 'Add amazing feature'`
4. **Push** –≤ branch: `git push origin feature/amazing-feature`
5. –û—Ç–∫—Ä–æ–π—Ç–µ **Pull Request**

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ª–∏—Ü–µ–Ω–∑–∏—Ä–æ–≤–∞–Ω –ø–æ–¥ MIT License - —Å–º. —Ñ–∞–π–ª [LICENSE](LICENSE) –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- **Issues**: [GitHub Issues](https://github.com/ncux-ad/Flame_Of_Styx_bot/issues)
- **Discussions**: [GitHub Discussions](https://github.com/ncux-ad/Flame_Of_Styx_bot/discussions)
- **Email**: [ncux-ad@github.com](mailto:ncux-ad@github.com)

## üéâ –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏

- **aiogram** - –æ—Ç–ª–∏—á–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è Telegram Bot API
- **SQLAlchemy** - –º–æ—â–Ω–∞—è ORM –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
- **Glances** - –ª–µ–≥–∫–∏–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- **Redis** - –±—ã—Å—Ç—Ä—ã–π –∫—ç—à –∏ rate limiting

---

**–°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è –∑–∞—â–∏—Ç—ã Telegram —Å–æ–æ–±—â–µ—Å—Ç–≤ –æ—Ç —Å–ø–∞–º–∞**