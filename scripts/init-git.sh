#!/bin/bash

# Load secure utilities
source "$(dirname "$0")/secure_shell_utils.sh"

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./scripts/init-git.sh

set -e

echo "üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –¥–ª—è AntiSpam Bot"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Git
if ! command -v git &> /dev/null; then
    echo "‚ùå Git –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
    exit 1
fi

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (–µ—Å–ª–∏ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω)
if [ ! -d ".git" ]; then
    echo "üìÅ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è..."
    git init
fi

# –î–æ–±–∞–≤–ª—è–µ–º remote origin (–µ—Å–ª–∏ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω)
if ! git remote | grep -q origin; then
    echo "üîó –î–æ–±–∞–≤—å—Ç–µ remote origin:"
    echo "   git remote add origin https://github.com/your-username/antispam-bot.git"
    echo "   git branch -M main"
fi

# –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã
echo "üìù –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –≤ Git..."
git add .

# –°–æ–∑–¥–∞–µ–º –ø–µ—Ä–≤—ã–π –∫–æ–º–º–∏—Ç
echo "üíæ –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ –∫–æ–º–º–∏—Ç–∞..."
if git diff --cached --quiet; then
    echo "‚ÑπÔ∏è  –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–º–º–∏—Ç–∞"
else
    git commit -m "üéâ Initial commit: AntiSpam Bot project setup

- ‚úÖ –ë–∞–∑–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ aiogram 3.x
- ‚úÖ –ú–æ–¥–µ–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (SQLAlchemy)
- ‚úÖ –°–µ—Ä–≤–∏—Å—ã –¥–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏ middleware
- ‚úÖ DevOps –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (Docker, systemd)
- ‚úÖ CI/CD —Å GitHub Actions
- ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ª–∏–Ω—Ç–µ—Ä—ã
- ‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ì–æ—Ç–æ–≤–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏! üöÄ"
    fi
fi

# –°–æ–∑–¥–∞–µ–º –≤–µ—Ç–∫—É develop
echo "üåø –°–æ–∑–¥–∞–Ω–∏–µ –≤–µ—Ç–∫–∏ develop..."
git checkout -b develop

echo "‚úÖ Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!"
echo ""
echo "üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
echo "1. –î–æ–±–∞–≤—å—Ç–µ remote origin:"
echo "   git remote add origin https://github.com/your-username/antispam-bot.git"
echo ""
echo "2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–¥ –Ω–∞ GitHub:"
echo "   git push -u origin main"
echo "   git push -u origin develop"
echo ""
echo "3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ .env —Ñ–∞–π–ª:"
echo "   cp env.example .env"
echo "   # –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª"
echo ""
echo "4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ:"
echo "   docker-compose up -d"
echo ""
echo "5. –ò–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:"
echo "   pip install -e \".[dev]\""
echo "   python bot.py"
