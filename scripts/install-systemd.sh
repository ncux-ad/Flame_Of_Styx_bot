#!/bin/bash

# Load secure utilities
source "$(dirname "$0")/secure_shell_utils.sh"
# Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ AntiSpam Bot Ñ‡ÐµÑ€ÐµÐ· systemd
# systemd installation script for AntiSpam Bot

set -e

# Ð¦Ð²ÐµÑ‚Ð° Ð´Ð»Ñ Ð²Ñ‹Ð²Ð¾Ð´Ð°
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

# Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¸ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ
log() { echo -e "${BLUE}[$(date '+%Y-%m-%d %H:%M:%S')]${NC} $1"; }
error() { echo -e "${RED}[ERROR]${NC} $1"; }
success() { echo -e "${GREEN}[SUCCESS]${NC} $1"; }
warning() { echo -e "${YELLOW}[WARNING]${NC} $1"; }

echo -e "${GREEN}"
echo "âš™ï¸  Ð£Ð¡Ð¢ÐÐÐžÐ’ÐšÐ ANTI-SPAM BOT Ð§Ð•Ð Ð•Ð— SYSTEMD"
echo "========================================"
echo -e "${NC}"

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ñ€Ð°Ð² root
if [ "$EUID" -ne 0 ]; then
    error "Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ñ Ð¿Ñ€Ð°Ð²Ð°Ð¼Ð¸ root: sudo bash install-systemd.sh"
    exit 1
fi

# Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
install_dependencies() {
    log "Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹..."

    # ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ð°ÐºÐµÑ‚Ð¾Ð²
    apt-get update -y

    # Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Python Ð¸ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
    apt-get install -y python3 python3-pip python3-venv python3-dev

    # Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ñ… Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
    apt-get install -y \
        build-essential \
        libssl-dev \
        libffi-dev \
        libxml2-dev \
        libxslt1-dev \
        zlib1g-dev \
        libjpeg-dev \
        libpng-dev \
        libfreetype6-dev \
        curl \
        wget \
        git \
        htop \
        nano \
        vim \
        ufw \
        fail2ban \
        cron \
        openssl \
        dnsutils \
        net-tools \
        nginx \
        certbot \
        python3-certbot-nginx \
        redis-server

    success "Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹"
}

# Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹
setup_system() {
    log "ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹..."

    # ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ñ„Ð°Ð¹Ñ€Ð²Ð¾Ð»Ð°
    ufw --force reset
    ufw default deny incoming
    ufw default allow outgoing
    ufw allow ssh
    ufw allow 80/tcp
    ufw allow 443/tcp
    ufw --force enable

    # ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° fail2ban
    cat > /etc/fail2ban/jail.local << 'EOF'
[DEFAULT]
bantime = 3600
findtime = 600
maxretry = 3

[sshd]
enabled = true
port = ssh
logpath = /var/log/auth.log
maxretry = 3
EOF

    systemctl enable fail2ban
    systemctl start fail2ban

    # Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
    if ! id "antispam" &>/dev/null; then
        useradd -r -s /bin/bash -d /opt/antispam-bot -m antispam
    fi

    # Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¹
    mkdir -p /opt/antispam-bot
    mkdir -p /var/log/antispam-bot
    mkdir -p /etc/antispam-bot
    mkdir -p /var/www/html

    chown -R antispam:antispam /opt/antispam-bot
    chown -R antispam:antispam /var/log/antispam-bot
    chown -R antispam:antispam /etc/antispam-bot
    chown -R www-data:www-data /var/www/html

    success "Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ð°"
}

# Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
get_config() {
    echo ""
    log "ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸:"

    # Ð”Ð¾Ð¼ÐµÐ½
    read -p "Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð´Ð¾Ð¼ÐµÐ½ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: bot.example.com): " DOMAIN
    if [ -z "$DOMAIN" ]; then
        error "Ð”Ð¾Ð¼ÐµÐ½ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÐµÐ½!"
        exit 1
    fi

    # Email
    read -p "Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ email Ð´Ð»Ñ Let's Encrypt: " EMAIL
    if [ -z "$EMAIL" ]; then
        error "Email Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÐµÐ½!"
        exit 1
    fi

    # Bot Token
    read -p "Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Telegram Bot Token: " BOT_TOKEN
    if [ -z "$BOT_TOKEN" ]; then
        error "Bot Token Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÐµÐ½!"
        exit 1
    fi

    # Admin IDs
    read -p "Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Admin IDs Ñ‡ÐµÑ€ÐµÐ· Ð·Ð°Ð¿ÑÑ‚ÑƒÑŽ: " ADMIN_IDS
    if [ -z "$ADMIN_IDS" ]; then
        ADMIN_IDS="123456789"
    fi

    # Redis Password
    read -p "Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ Ð´Ð»Ñ Redis (Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ: random): " REDIS_PASSWORD
    if [ -z "$REDIS_PASSWORD" ]; then
        REDIS_PASSWORD=$(openssl rand -base64 32)
        success "Ð¡Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½ ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ñ‹Ð¹ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ Redis"
    fi

    success "ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð°"
}

# Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ñ„Ð°Ð¹Ð»Ð¾Ð²
copy_files() {
    log "ÐšÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ„Ð°Ð¹Ð»Ð¾Ð² Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°..."

    # ÐšÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð²ÑÐµÑ… Ñ„Ð°Ð¹Ð»Ð¾Ð²
    cp -r . /opt/antispam-bot/
    chown -R antispam:antispam /opt/antispam-bot

    success "Ð¤Ð°Ð¹Ð»Ñ‹ ÑÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹"
}

# Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ
create_venv() {
    log "Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ..."

    # Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ
    sudo -u antispam python3 -m venv /opt/antispam-bot/venv

    # Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
    sudo -u antispam /opt/antispam-bot/venv/bin/pip install --upgrade pip
    sudo -u antispam /opt/antispam-bot/venv/bin/pip install -r /opt/antispam-bot/requirements.txt

    success "Ð’Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ðµ ÑÐ¾Ð·Ð´Ð°Ð½Ð¾"
}

# Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Redis
setup_redis() {
    log "ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Redis..."

    # ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Redis
    cat > /etc/redis/redis.conf << EOF
# Redis configuration for AntiSpam Bot
bind 127.0.0.1
port 6379
requirepass $REDIS_PASSWORD
maxmemory 256mb
maxmemory-policy allkeys-lru
save 900 1
save 300 10
save 60 10000
EOF

    systemctl enable redis-server
    systemctl restart redis-server

    success "Redis Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½"
}

# Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ systemd ÑÐµÑ€Ð²Ð¸ÑÐ°
create_systemd_service() {
    log "Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ systemd ÑÐµÑ€Ð²Ð¸ÑÐ°..."

    # Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
    cat > /etc/antispam-bot/.env << EOF
BOT_TOKEN=$BOT_TOKEN
ADMIN_IDS=$ADMIN_IDS
DB_PATH=/opt/antispam-bot/db.sqlite3
REDIS_PASSWORD=$REDIS_PASSWORD
NOTIFICATION_WEBHOOK=
EOF

    # Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ systemd ÑÐµÑ€Ð²Ð¸ÑÐ°
    cat > /etc/systemd/system/antispam-bot.service << EOF
[Unit]
Description=AntiSpam Bot Service
After=network.target redis.service

[Service]
Type=simple
User=antispam
Group=antispam
WorkingDirectory=/opt/antispam-bot
Environment=PATH=/opt/antispam-bot/venv/bin
EnvironmentFile=/etc/antispam-bot/.env
ExecStart=/opt/antispam-bot/venv/bin/python bot.py
Restart=always
RestartSec=10
StandardOutput=journal
StandardError=journal
SyslogIdentifier=antispam-bot

[Install]
WantedBy=multi-user.target
EOF

    # Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð° Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ
    cat > /opt/antispam-bot/update.sh << 'EOF'
#!/bin/bash
cd /opt/antispam-bot
git pull origin main
/opt/antispam-bot/venv/bin/pip install -r requirements.txt
systemctl restart antispam-bot
EOF

    chmod +x /opt/antispam-bot/update.sh

    # Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ cron Ð·Ð°Ð´Ð°Ñ‡Ð¸
    echo "0 3 * * * /opt/antispam-bot/update.sh >> /var/log/antispam-bot/update.log 2>&1" | crontab -u antispam -

    success "systemd ÑÐµÑ€Ð²Ð¸Ñ ÑÐ¾Ð·Ð´Ð°Ð½"
}

# Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ nginx
setup_nginx() {
    log "ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° nginx..."

    # Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸ nginx
    cat > /etc/nginx/sites-available/antispam-bot << EOF
server {
    listen 80;
    server_name $DOMAIN;

    location /.well-known/acme-challenge/ {
        root /var/www/html;
    }

    location / {
        return 301 https://\$server_name\$request_uri;
    }
}

server {
    listen 443 ssl http2;
    server_name $DOMAIN;

    ssl_certificate /etc/letsencrypt/live/$DOMAIN/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/$DOMAIN/privkey.pem;

    # SSL Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;

    # Security headers
    add_header Strict-Transport-Security "max-age=63072000" always;
    add_header X-Frame-Options DENY;
    add_header X-Content-Type-Options nosniff;
    add_header X-XSS-Protection "1; mode=block";

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host \$host;
        proxy_set_header X-Real-IP \$remote_addr;
        proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto \$scheme;
    }
}
EOF

    # Ð’ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ ÑÐ°Ð¹Ñ‚Ð°
    ln -sf /etc/nginx/sites-available/antispam-bot /etc/nginx/sites-enabled/
    rm -f /etc/nginx/sites-enabled/default

    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
    nginx -t

    systemctl enable nginx
    systemctl restart nginx

    success "nginx Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½"
}

# Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Let's Encrypt
setup_letsencrypt() {
    log "ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Let's Encrypt..."

    # ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ð²
    certbot certonly --webroot -w /var/www/html -d $DOMAIN --email $EMAIL --agree-tos --non-interactive

    # ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð°Ð²Ñ‚Ð¾Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ
    echo "0 2 * * * certbot renew --quiet && systemctl reload nginx" | crontab -

    # ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐº nginx Ñ SSL
    systemctl reload nginx

    success "Let's Encrypt Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½"
}

# Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð° ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ
create_management_script() {
    log "Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð° ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ..."

    cat > /usr/local/bin/antispam-bot << 'EOF'
#!/bin/bash
case "$1" in
    start)
        systemctl start antispam-bot
        ;;
    stop)
        systemctl stop antispam-bot
        ;;
    restart)
        systemctl restart antispam-bot
        ;;
    status)
        systemctl status antispam-bot
        ;;
    logs)
        journalctl -u antispam-bot -f
        ;;
    update)
        /opt/antispam-bot/update.sh
        ;;
    nginx-logs)
        journalctl -u nginx -f
        ;;
    redis-logs)
        journalctl -u redis-server -f
        ;;
    *)
        echo "Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ: $0 {start|stop|restart|status|logs|update|nginx-logs|redis-logs}"
        exit 1
        ;;
esac
EOF

    chmod +x /usr/local/bin/antispam-bot

    success "Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ ÑÐ¾Ð·Ð´Ð°Ð½"
}

# Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð·Ð°Ð¿ÑƒÑÐºÐ° ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð²
start_services() {
    log "Ð—Ð°Ð¿ÑƒÑÐº ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð²..."

    # Ð’ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð¸ Ð·Ð°Ð¿ÑƒÑÐº ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð²
    systemctl enable antispam-bot
    systemctl start antispam-bot

    # ÐžÐ¶Ð¸Ð´Ð°Ð½Ð¸Ðµ Ð·Ð°Ð¿ÑƒÑÐºÐ°
    sleep 5

    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ð°Ñ‚ÑƒÑÐ°
    if systemctl is-active --quiet antispam-bot; then
        success "Ð¡ÐµÑ€Ð²Ð¸Ñ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½"
    else
        error "ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð¿ÑƒÑÐºÐ° ÑÐµÑ€Ð²Ð¸ÑÐ°"
        systemctl status antispam-bot
        exit 1
    fi
}

# Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð²Ñ‹Ð²Ð¾Ð´Ð° Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸
show_info() {
    echo ""
    success "ðŸŽ‰ Ð£Ð¡Ð¢ÐÐÐžÐ’ÐšÐ Ð—ÐÐ’Ð•Ð Ð¨Ð•ÐÐ!"
    echo ""
    echo -e "${GREEN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${GREEN}â•‘                    Ð˜ÐÐ¤ÐžÐ ÐœÐÐ¦Ð˜Ð¯ ÐžÐ‘ Ð£Ð¡Ð¢ÐÐÐžÐ’ÐšÐ•                  â•‘${NC}"
    echo -e "${GREEN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
    echo -e "${YELLOW}ðŸŒ Ð”Ð¾Ð¼ÐµÐ½:${NC} $DOMAIN"
    echo -e "${YELLOW}ðŸ“§ Email:${NC} $EMAIL"
    echo -e "${YELLOW}ðŸ¤– Bot Token:${NC} ${BOT_TOKEN:0:10}..."
    echo -e "${YELLOW}ðŸ‘‘ Admin IDs:${NC} $ADMIN_IDS"
    echo ""
    echo -e "${YELLOW}ðŸ“‹ ÐšÐ¾Ð¼Ð°Ð½Ð´Ñ‹ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ:${NC}"
    echo "  antispam-bot start       - Ð—Ð°Ð¿ÑƒÑÐº Ð±Ð¾Ñ‚Ð°"
    echo "  antispam-bot stop        - ÐžÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð±Ð¾Ñ‚Ð°"
    echo "  antispam-bot restart     - ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐº Ð±Ð¾Ñ‚Ð°"
    echo "  antispam-bot status      - Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ð±Ð¾Ñ‚Ð°"
    echo "  antispam-bot logs        - ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð»Ð¾Ð³Ð¾Ð²"
    echo "  antispam-bot update      - ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð±Ð¾Ñ‚Ð°"
    echo "  antispam-bot nginx-logs  - Ð›Ð¾Ð³Ð¸ nginx"
    echo "  antispam-bot redis-logs  - Ð›Ð¾Ð³Ð¸ Redis"
    echo ""
    echo -e "${YELLOW}ðŸ”— ÐŸÐ¾Ð»ÐµÐ·Ð½Ñ‹Ðµ ÑÑÑ‹Ð»ÐºÐ¸:${NC}"
    echo "  https://$DOMAIN - Ð’ÐµÐ±-Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ"
    echo "  /opt/antispam-bot - Ð”Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ñ Ð±Ð¾Ñ‚Ð°"
    echo "  /var/log/antispam-bot - Ð›Ð¾Ð³Ð¸ Ð±Ð¾Ñ‚Ð°"
    echo "  /etc/antispam-bot - ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ Ð±Ð¾Ñ‚Ð°"
    echo ""
    echo -e "${GREEN}âœ… Ð‘Ð¾Ñ‚ Ð³Ð¾Ñ‚Ð¾Ð² Ðº Ñ€Ð°Ð±Ð¾Ñ‚Ðµ!${NC}"
    echo ""
}

# Ð“Ð»Ð°Ð²Ð½Ð°Ñ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ
main() {
    install_dependencies
    setup_system
    get_config
    copy_files
    create_venv
    setup_redis
    create_systemd_service
    setup_nginx
    setup_letsencrypt
    create_management_script
    start_services
    show_info
}

# Ð—Ð°Ð¿ÑƒÑÐº
main "$@"
