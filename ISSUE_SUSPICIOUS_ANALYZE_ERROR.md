# üêõ Issue: –û—à–∏–±–∫–∞ –≤ –∫–æ–º–∞–Ω–¥–µ `/suspicious_analyze`

## üìã –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–ö–æ–º–∞–Ω–¥–∞ `/suspicious_analyze <user_id>` –≤—ã–¥–∞–µ—Ç –æ—à–∏–±–∫—É:
```
‚ùå –û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ—Ñ–∏–ª—è
```

–í –ª–æ–≥–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞:
```
ERROR - Error in analyze_user_profile: expected string or bytes-like object, got 'int'
ERROR - Error in suspicious_analyze command: expected string or bytes-like object, got 'int'
```

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–∏—á–∏–Ω–∞
–û—à–∏–±–∫–∞ `expected string or bytes-like object, got 'int'` –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `analyze_user_profile` –≤ —Ñ–∞–π–ª–µ `app/services/profiles.py` –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –º–µ—Ç–æ–¥–æ–≤ (`.lower()`) –Ω–∞ –ø–æ–ª—è—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å `int` –≤–º–µ—Å—Ç–æ `str`.

### –ú–µ—Å—Ç–∞ –æ—à–∏–±–æ–∫
1. **–°—Ç—Ä–æ–∫–∞ 206**: `user.username.lower()` - –µ—Å–ª–∏ `user.username` —Å–æ–¥–µ—Ä–∂–∏—Ç `int`
2. **–°—Ç—Ä–æ–∫–∞ 212**: `user.first_name.lower()` - –µ—Å–ª–∏ `user.first_name` —Å–æ–¥–µ—Ä–∂–∏—Ç `int`
3. **F-—Å—Ç—Ä–æ–∫–∏ –≤ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏** - –ø–µ—Ä–µ–¥–∞—á–∞ `int` –≤ f-—Å—Ç—Ä–æ–∫–∏

## üîß –ü–æ–ø—ã—Ç–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
1. ‚úÖ –ó–∞–º–µ–Ω–µ–Ω—ã f-—Å—Ç—Ä–æ–∫–∏ –Ω–∞ –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—é –≤ `app/handlers/admin.py`
2. ‚úÖ –ó–∞–º–µ–Ω–µ–Ω—ã f-—Å—Ç—Ä–æ–∫–∏ –Ω–∞ –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—é –≤ `app/services/profiles.py`
3. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ —Å—Ç—Ä–æ–∫–µ –≤ `_detect_suspicious_patterns`
4. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
–û—à–∏–±–∫–∞ –≤—Å–µ –µ—â–µ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –≤—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

## üéØ –¢—Ä–µ–±—É–µ—Ç—Å—è

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:
- –ù–∞–π—Ç–∏ —Ç–æ—á–Ω–æ–µ –º–µ—Å—Ç–æ –æ—à–∏–±–∫–∏ —Å –ø–æ–º–æ—â—å—é –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- –ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ –º–µ—Å—Ç–∞ –≥–¥–µ `int` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:
- –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Ñ—É–Ω–∫—Ü–∏–∏ `analyze_user_profile` —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ç–∏–ø–∏–∑–∞—Ü–∏–µ–π
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `str()` –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π

## üìä –°—Ç–∞—Ç—É—Å
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –í—ã—Å–æ–∫–∏–π
- **–°—Ç–∞—Ç—É—Å**: –í —Ä–∞–±–æ—Ç–µ
- **–ù–∞–∑–Ω–∞—á–µ–Ω–æ**: @ncux-ad
- **–°–æ–∑–¥–∞–Ω–æ**: 2025-09-28
- **–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 2025-09-28

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- `app/handlers/admin.py` - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã
- `app/services/profiles.py` - –ª–æ–≥–∏–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ—Ñ–∏–ª–µ–π
- `app/models/suspicious_profile.py` - –º–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö

## üìù –õ–æ–≥–∏ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
```
Sep 28 02:04:38 vm739138 antispam-bot[1108450]: 2025-09-28 02:04:38,859 - app.services.profiles - INFO - Analysis result for user 1837038582: score=0.2, patterns=['no_username', 'no_last_name'], is_suspicious=False
Sep 28 02:04:38 vm739138 antispam-bot[1108450]: 2025-09-28 02:04:38,859 - app.handlers.admin - ERROR - Error in analyze_user_profile: expected string or bytes-like object, got 'int'
Sep 28 02:04:38 vm739138 antispam-bot[1108450]: 2025-09-28 02:04:38,859 - app.handlers.admin - ERROR - Error in suspicious_analyze command: expected string or bytes-like object, got 'int'
```

## üè∑Ô∏è –¢–µ–≥–∏
`bug` `suspicious-analyze` `type-error` `high-priority` `needs-investigation`
