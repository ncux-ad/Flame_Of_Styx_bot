# üë®‚Äçüíª –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
ad_anti_spam_bot_full/
‚îú‚îÄ‚îÄ app/                    # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ handlers/          # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin.py       # –ê–¥–º–∏–Ω—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.py        # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ channels.py    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–Ω–∞–ª–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ middlewares/       # Middleware
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dependency_injection.py  # DI middleware
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logging.py     # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ratelimit.py   # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ services/          # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bots.py        # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞–º–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ channels.py    # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞–º–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ links.py       # –ê–Ω–∞–ª–∏–∑ —Å—Å—ã–ª–æ–∫
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ profiles.py    # –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ—Ñ–∏–ª–µ–π
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ moderation.py  # –ú–æ–¥–µ—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ models/            # –ú–æ–¥–µ–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bot.py         # –ú–æ–¥–µ–ª—å –±–æ—Ç–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ channel.py     # –ú–æ–¥–µ–ª—å –∫–∞–Ω–∞–ª–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ profile.py     # –ú–æ–¥–µ–ª—å –ø—Ä–æ—Ñ–∏–ª—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ link.py        # –ú–æ–¥–µ–ª—å —Å—Å—ã–ª–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ filters/           # –§–∏–ª—å—Ç—Ä—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ is_admin.py    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ is_admin_or_silent.py  # –¢–∏—Ö–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ keyboards/         # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ inline.py      # Inline –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ reply.py       # Reply –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ database.py        # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ config.py          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ tests/                 # –¢–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ docs/                  # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ data/                  # –î–∞–Ω–Ω—ã–µ (–ë–î, —Ñ–∞–π–ª—ã)
‚îú‚îÄ‚îÄ logs/                  # –õ–æ–≥–∏
‚îú‚îÄ‚îÄ bot.py                 # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ requirements.txt       # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îú‚îÄ‚îÄ Dockerfile            # Docker –æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ docker-compose.yml    # Docker Compose
‚îî‚îÄ‚îÄ README.md             # –û—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üõ†Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ä–µ–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
python -m venv venv

# –ê–∫—Ç–∏–≤–∞—Ü–∏—è (Linux/macOS)
source venv/bin/activate

# –ê–∫—Ç–∏–≤–∞—Ü–∏—è (Windows)
venv\Scripts\activate

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞
cp env.example .env

# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
nano .env
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ IDE

#### VS Code

–°–æ–∑–¥–∞–π—Ç–µ `.vscode/settings.json`:

```json
{
    "python.defaultInterpreterPath": "./venv/bin/python",
    "python.linting.enabled": true,
    "python.linting.pylintEnabled": true,
    "python.formatting.provider": "black",
    "python.testing.pytestEnabled": true,
    "python.testing.pytestArgs": ["tests/"],
    "terminal.integrated.defaultProfile.windows": "PowerShell"
}
```

#### PyCharm

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –≤ PyCharm
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä Python –Ω–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Run Configuration

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
python -m pytest

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
python -m pytest --cov=app

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
python -m pytest tests/test_handlers.py::test_start_command

# –° –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
python -m pytest -v
```

### –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤

```python
# tests/test_handlers.py
import pytest
from unittest.mock import AsyncMock, MagicMock
from app.handlers.admin import handle_start_command

@pytest.mark.asyncio
async def test_start_command():
    """Test /start command handler."""
    # –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
    message = MagicMock()
    message.answer = AsyncMock()

    # –í—ã–∑–æ–≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
    await handle_start_command(message, data={})

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–∑–æ–≤–∞
    message.answer.assert_called_once()
```

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

```python
# app/services/new_service.py
from typing import Optional
from app.database import get_db
from app.models.new_model import NewModel

class NewService:
    """New service for handling specific functionality."""

    def __init__(self, bot, db_session):
        self.bot = bot
        self.db_session = db_session

    async def create_item(self, data: dict) -> Optional[NewModel]:
        """Create new item."""
        # Implementation here
        pass

    async def get_item(self, item_id: int) -> Optional[NewModel]:
        """Get item by ID."""
        # Implementation here
        pass
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞

```python
# app/handlers/new_handler.py
import logging
from aiogram import Router
from aiogram.filters import Command
from aiogram.types import Message

logger = logging.getLogger(__name__)
router = Router()

@router.message(Command("newcommand"))
async def handle_new_command(message: Message, data: dict = None) -> None:
    """Handle new command."""
    try:
        # Get service from data
        service = data.get('new_service') if data else None

        if not service:
            logger.error("Service not injected properly")
            return

        # Handle command logic
        await message.answer("New command executed!")

    except Exception as e:
        logger.error(f"Error handling new command: {e}")
```

### 3. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ DI middleware

```python
# app/middlewares/dependency_injection.py
from app.services.new_service import NewService

# –í –º–µ—Ç–æ–¥–µ __call__ –¥–æ–±–∞–≤–∏—Ç—å:
services = {
    'link_service': LinkService(bot, db_session),
    'profile_service': ProfileService(bot, db_session),
    'channel_service': ChannelService(bot, db_session),
    'bot_service': BotService(bot, db_session),
    'moderation_service': ModerationService(bot, db_session),
    'new_service': NewService(bot, db_session),  # –ù–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å
    'db_session': db_session
}
```

### 4. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–æ—É—Ç–µ—Ä–∞

```python
# bot.py
from app.handlers import new_handler

# –í —Ñ—É–Ω–∫—Ü–∏–∏ main():
dp.include_router(new_handler.router)
```

## üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –º–æ–¥–µ–ª–∏

```python
# app/models/new_model.py
from sqlalchemy import Column, Integer, String, DateTime, Boolean
from sqlalchemy.ext.declarative import declarative_base
from datetime import datetime

Base = declarative_base()

class NewModel(Base):
    """New model for database."""

    __tablename__ = 'new_models'

    id = Column(Integer, primary_key=True)
    name = Column(String(255), nullable=False)
    description = Column(String(1000))
    is_active = Column(Boolean, default=True)
    created_at = Column(DateTime, default=datetime.utcnow)

    def __repr__(self):
        return f"<NewModel(id={self.id}, name='{self.name}')>"
```

### 2. –ú–∏–≥—Ä–∞—Ü–∏–∏

```python
# app/database.py
from app.models.new_model import NewModel

# –í —Ñ—É–Ω–∫—Ü–∏–∏ create_tables():
Base.metadata.create_all(bind=engine)
```

## üîç –û—Ç–ª–∞–¥–∫–∞

### 1. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
import logging

logger = logging.getLogger(__name__)

# –†–∞–∑–ª–∏—á–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logger.debug("Debug message")
logger.info("Info message")
logger.warning("Warning message")
logger.error("Error message")
logger.critical("Critical message")
```

### 2. –û—Ç–ª–∞–¥–∫–∞ –≤ VS Code

–°–æ–∑–¥–∞–π—Ç–µ `.vscode/launch.json`:

```json
{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Python: Bot",
            "type": "python",
            "request": "launch",
            "program": "bot.py",
            "console": "integratedTerminal",
            "env": {
                "BOT_TOKEN": "your_token_here",
                "ADMIN_IDS": "123456789,987654321",
                "DB_PATH": "db.sqlite3"
            }
        }
    ]
}
```

### 3. –û—Ç–ª–∞–¥–∫–∞ Docker

```bash
# –ó–∞–ø—É—Å–∫ —Å –æ—Ç–ª–∞–¥–∫–æ–π
docker-compose -f docker-compose.debug.yml up

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É
docker exec -it antispam-bot bash

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker logs antispam-bot -f
```

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### 1. –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å–∫ –±–µ–∑ Docker
python bot.py

# –ó–∞–ø—É—Å–∫ —Å Docker
docker-compose up --build
```

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
docker-compose -f docker-compose.test.yml up

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
docker-compose exec antispam-bot python -m pytest
```

## üìù –°—Ç–∏–ª—å –∫–æ–¥–∞

### 1. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ black
pip install black

# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
black app/

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∏–ª—è
black --check app/
```

### 2. –õ–∏–Ω—Ç–∏–Ω–≥

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ pylint
pip install pylint

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
pylint app/

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pylint
pylint --rcfile=.pylintrc app/
```

### 3. –¢–∏–ø–∏–∑–∞—Ü–∏—è

```python
from typing import Optional, List, Dict, Any
from aiogram.types import Message, CallbackQuery

async def handler(
    message: Message,
    data: Optional[Dict[str, Any]] = None
) -> None:
    """Handler with proper type hints."""
    pass
```

## üîÑ CI/CD

### GitHub Actions

–°–æ–∑–¥–∞–π—Ç–µ `.github/workflows/ci.yml`:

```yaml
name: CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2

    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: 3.11

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pytest pytest-cov

    - name: Run tests
      run: |
        python -m pytest --cov=app tests/

    - name: Upload coverage
      uses: codecov/codecov-action@v1
```

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [aiogram 3 –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://docs.aiogram.dev/)
- [SQLAlchemy –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://docs.sqlalchemy.org/)
- [Pytest –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://docs.pytest.org/)
- [Docker –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://docs.docker.com/)
- [–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ DI](DI_BEST_PRACTICES.md)

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

1. –§–æ—Ä–∫–Ω–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É: `git checkout -b feature/new-feature`
3. –í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –¥–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç—ã
4. –ó–∞—Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è: `git commit -m "Add new feature"`
5. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≤ –≤–µ—Ç–∫—É: `git push origin feature/new-feature`
6. –°–æ–∑–¥–∞–π—Ç–µ Pull Request

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã:

1. –ò–∑—É—á–∏—Ç–µ [–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø–æ DI](DI_BEST_PRACTICES.md)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ [—Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é](DEPLOYMENT.md)
3. –°–æ–∑–¥–∞–π—Ç–µ Issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –ª–æ–≥–∞–º –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
